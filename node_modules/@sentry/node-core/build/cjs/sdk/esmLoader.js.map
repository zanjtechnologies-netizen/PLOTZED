{"version":3,"file":"esmLoader.js","sources":["../../../src/sdk/esmLoader.ts"],"sourcesContent":["import { debug, GLOBAL_OBJ } from '@sentry/core';\nimport { createAddHookMessageChannel } from 'import-in-the-middle';\nimport * as moduleModule from 'module';\nimport { supportsEsmLoaderHooks } from '../utils/detection';\n\n/**\n * Initialize the ESM loader - This method is private and not part of the public\n * API.\n *\n * @ignore\n */\nexport function initializeEsmLoader(): void {\n  if (!supportsEsmLoaderHooks()) {\n    return;\n  }\n\n  if (!GLOBAL_OBJ._sentryEsmLoaderHookRegistered) {\n    GLOBAL_OBJ._sentryEsmLoaderHookRegistered = true;\n\n    try {\n      const { addHookMessagePort } = createAddHookMessageChannel();\n      // @ts-expect-error register is available in these versions\n      moduleModule.register('import-in-the-middle/hook.mjs', import.meta.url, {\n        data: { addHookMessagePort, include: [] },\n        transferList: [addHookMessagePort],\n      });\n    } catch (error) {\n      debug.warn(\"Failed to register 'import-in-the-middle' hook\", error);\n    }\n  }\n}\n"],"names":["supportsEsmLoaderHooks","GLOBAL_OBJ","createAddHookMessageChannel","debug"],"mappings":";;;;;;;;AAKA;AACA;AACA;AACA;AACA;AACA;AACO,SAAS,mBAAmB,GAAS;AAC5C,EAAE,IAAI,CAACA,gCAAsB,EAAE,EAAE;AACjC,IAAI;AACJ;;AAEA,EAAE,IAAI,CAACC,eAAU,CAAC,8BAA8B,EAAE;AAClD,IAAIA,eAAU,CAAC,8BAAA,GAAiC,IAAI;;AAEpD,IAAI,IAAI;AACR,MAAM,MAAM,EAAE,kBAAA,KAAuBC,6CAA2B,EAAE;AAClE;AACA,MAAM,YAAY,CAAC,QAAQ,CAAC,+BAA+B,EAAE,kQAAe,EAAE;AAC9E,QAAQ,IAAI,EAAE,EAAE,kBAAkB,EAAE,OAAO,EAAE,EAAC,EAAG;AACjD,QAAQ,YAAY,EAAE,CAAC,kBAAkB,CAAC;AAC1C,OAAO,CAAC;AACR,KAAI,CAAE,OAAO,KAAK,EAAE;AACpB,MAAMC,UAAK,CAAC,IAAI,CAAC,gDAAgD,EAAE,KAAK,CAAC;AACzE;AACA;AACA;;;;"}