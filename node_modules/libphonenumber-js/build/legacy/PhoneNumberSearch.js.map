{"version":3,"file":"PhoneNumberSearch.js","names":["_parse","_interopRequireDefault","require","_isViablePhoneNumber","_parsePreCandidate","_isValidPreCandidate","_isValidCandidate","_constants","e","__esModule","_typeof","o","Symbol","iterator","constructor","prototype","_classCallCheck","a","n","TypeError","_defineProperties","r","t","length","enumerable","configurable","writable","Object","defineProperty","_toPropertyKey","key","_createClass","i","_toPrimitive","toPrimitive","call","String","Number","WHITESPACE_IN_THE_BEGINNING_PATTERN","RegExp","WHITESPACE","PUNCTUATION_IN_THE_END_PATTERN","VALID_PUNCTUATION","PhoneNumberSearch","exports","text","options","metadata","state","regexp","VALID_PHONE_NUMBER_WITH_EXTENSION","value","find","matches","exec","number","startsAt","index","replace","parsePreCandidate","result","parseCandidate","isValidPreCandidate","isValidCandidate","extended","parse","phone","endsAt","hasNext","last_match","next","Error"],"sources":["../../source/legacy/PhoneNumberSearch.js"],"sourcesContent":["import parse from '../parse.js'\r\nimport { VALID_PHONE_NUMBER_WITH_EXTENSION } from '../helpers/isViablePhoneNumber.js'\r\n\r\nimport parsePreCandidate from '../findNumbers/parsePreCandidate.js'\r\nimport isValidPreCandidate from '../findNumbers/isValidPreCandidate.js'\r\nimport isValidCandidate from '../findNumbers/isValidCandidate.js'\r\n\r\nimport {\r\n\t// PLUS_CHARS,\r\n\tVALID_PUNCTUATION,\r\n\t// VALID_DIGITS,\r\n\tWHITESPACE\r\n} from '../constants.js'\r\n\r\nconst WHITESPACE_IN_THE_BEGINNING_PATTERN = new RegExp('^[' + WHITESPACE + ']+')\r\nconst PUNCTUATION_IN_THE_END_PATTERN = new RegExp('[' + VALID_PUNCTUATION + ']+$')\r\n\r\n/**\r\n * Extracts a parseable phone number including any opening brackets, etc.\r\n * @param  {string} text - Input.\r\n * @return {object} `{ ?number, ?startsAt, ?endsAt }`.\r\n */\r\nexport default class PhoneNumberSearch {\r\n\tconstructor(text, options, metadata) {\r\n\t\tthis.text = text\r\n\t\t// If assigning the `{}` default value is moved to the arguments above,\r\n\t\t// code coverage would decrease for some weird reason.\r\n\t\tthis.options = options || {}\r\n\t\tthis.metadata = metadata\r\n\r\n\t\t// Iteration tristate.\r\n\t\tthis.state = 'NOT_READY'\r\n\r\n\t\tthis.regexp = new RegExp(VALID_PHONE_NUMBER_WITH_EXTENSION, 'ig')\r\n\t}\r\n\r\n\tfind() {\r\n\t\tconst matches = this.regexp.exec(this.text)\r\n\t\tif (!matches) {\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tlet number = matches[0]\r\n\t\tlet startsAt = matches.index\r\n\r\n\t\tnumber = number.replace(WHITESPACE_IN_THE_BEGINNING_PATTERN, '')\r\n\t\tstartsAt += matches[0].length - number.length\r\n\t\t// Fixes not parsing numbers with whitespace in the end.\r\n\t\t// Also fixes not parsing numbers with opening parentheses in the end.\r\n\t\t// https://github.com/catamphetamine/libphonenumber-js/issues/252\r\n\t\tnumber = number.replace(PUNCTUATION_IN_THE_END_PATTERN, '')\r\n\r\n\t\tnumber = parsePreCandidate(number)\r\n\r\n\t\tconst result = this.parseCandidate(number, startsAt)\r\n\t\tif (result) {\r\n\t\t\treturn result\r\n\t\t}\r\n\r\n\t\t// Tail recursion.\r\n\t\t// Try the next one if this one is not a valid phone number.\r\n\t\treturn this.find()\r\n\t}\r\n\r\n\tparseCandidate(number, startsAt) {\r\n\t\tif (!isValidPreCandidate(number, startsAt, this.text)) {\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\t// Don't parse phone numbers which are non-phone numbers\r\n\t\t// due to being part of something else (e.g. a UUID).\r\n\t\t// https://github.com/catamphetamine/libphonenumber-js/issues/213\r\n\t\t// Copy-pasted from Google's `PhoneNumberMatcher.js` (`.parseAndValidate()`).\r\n\t\tif (!isValidCandidate(number, startsAt, this.text, this.options.extended ? 'POSSIBLE' : 'VALID')) {\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\t// // Prepend any opening brackets left behind by the\r\n\t\t// // `PHONE_NUMBER_START_PATTERN` regexp.\r\n\t\t// const text_before_number = text.slice(this.searching_from, startsAt)\r\n\t\t// const full_number_starts_at = text_before_number.search(BEFORE_NUMBER_DIGITS_PUNCTUATION)\r\n\t\t// if (full_number_starts_at >= 0) {\r\n\t\t// \tnumber = text_before_number.slice(full_number_starts_at) + number\r\n\t\t// \tstartsAt = full_number_starts_at\r\n\t\t// }\r\n\t\t//\r\n\t\t// this.searching_from = matches.lastIndex\r\n\r\n\t\tconst result = parse(number, this.options, this.metadata)\r\n\t\tif (!result.phone) {\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tresult.startsAt = startsAt\r\n\t\tresult.endsAt = startsAt + number.length\r\n\t\treturn result\r\n\t}\r\n\r\n\thasNext() {\r\n\t\tif (this.state === 'NOT_READY') {\r\n\t\t\tthis.last_match = this.find()\r\n\t\t\tif (this.last_match) {\r\n\t\t\t\tthis.state = 'READY'\r\n\t\t\t} else {\r\n\t\t\t\tthis.state = 'DONE'\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this.state === 'READY'\r\n\t}\r\n\r\n\tnext() {\r\n\t\t// Check the state and find the next match as a side-effect if necessary.\r\n\t\tif (!this.hasNext()) {\r\n\t\t\tthrow new Error('No next element')\r\n\t\t}\r\n\t\t// Don't retain that memory any longer than necessary.\r\n\t\tconst result = this.last_match\r\n\t\tthis.last_match = null\r\n\t\tthis.state = 'NOT_READY'\r\n\t\treturn result\r\n\t}\r\n}"],"mappings":"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","ignoreList":[]}