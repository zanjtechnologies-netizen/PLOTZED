generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_DATABASE_URL")
}

model accounts {
  id                String  @id
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  users             users   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model activity_logs {
  id          String   @id
  user_id     String?
  action      String
  entity_type String?
  entity_id   String?
  ip_address  String?
  user_agent  String?
  metadata    Json?
  created_at  DateTime @default(now())

  @@index([created_at])
  @@index([user_id])
}

model blog_posts {
  id               String    @id
  title            String
  slug             String    @unique
  content          String
  excerpt          String?
  featured_image   String?
  category         String?
  tags             String[]
  meta_title       String?
  meta_description String?
  is_published     Boolean   @default(false)
  published_at     DateTime?
  created_at       DateTime  @default(now())
  updated_at       DateTime  

  @@index([is_published])
  @@index([slug])
}

model inquiries {
  id         String        @id
  user_id    String?
  plot_id    String?
  name       String
  email      String
  phone      String
  message    String
  source     String?
  utm_source String?
  utm_medium String?
  status     InquiryStatus @default(NEW)
  created_at DateTime      @default(now())
  updated_at DateTime
  plots      plots?        @relation(fields: [plot_id], references: [id])
  users      users?        @relation(fields: [user_id], references: [id])

  @@index([created_at])
  @@index([status])
}

model plots {
  id               String        @id
  title            String
  slug             String        @unique
  description      String?
  price            Decimal       @db.Decimal(15, 2)
  original_price   Decimal?      @db.Decimal(15, 2)
  booking_amount   Decimal       @db.Decimal(15, 2)
  plot_size        Decimal       @db.Decimal(10, 2)
  dimensions       String?
  facing           String?
  address          String
  city             String
  state            String
  pincode          String
  latitude         Decimal?      @db.Decimal(10, 8)
  longitude        Decimal?      @db.Decimal(11, 8)
  rera_number      String?
  approved_layout  String?
  legal_docs       String[]
  hero_image       String?
  images           String[]
  videos           String[]
  tour_360         String?
  brochure         String?
  amenities        String[]
  nearby_places    Json?
  status           PlotStatus    @default(AVAILABLE)
  meta_title       String?
  meta_description String?
  is_featured      Boolean       @default(false)
  is_published     Boolean       @default(true)
  created_at       DateTime      @default(now())
  updated_at       DateTime
  inquiries        inquiries[]
  site_visits      site_visits[]

  @@index([city])
  @@index([is_featured])
  @@index([slug])
  @@index([status])
}

model refresh_tokens {
  id         String   @id
  token      String   @unique
  expires_at DateTime
  user_id    String
  created_at DateTime @default(now())
  updated_at DateTime
  users      users    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
}

model sessions {
  id           String   @id
  sessionToken String   @unique
  userId       String
  expires      DateTime
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model site_visits {
  id            String          @id
  user_id       String
  plot_id       String
  visit_date    DateTime
  visit_time    String
  attendees     Int             @default(1)
  status        SiteVisitStatus @default(PENDING)
  notes         String?
  created_at    DateTime        @default(now())
  updated_at    DateTime
  admin_notes   String?
  cancelled_at  DateTime?
  completed_at  DateTime?
  confirmed_at  DateTime?
  contact_email String?
  contact_name  String?
  contact_phone String?
  feedback      String?
  rating        Int?
  plots         plots           @relation(fields: [plot_id], references: [id])
  users         users           @relation(fields: [user_id], references: [id])

  @@index([plot_id])
  @@index([status])
  @@index([user_id])
  @@index([visit_date])
}

model users {
  id                         String           @id
  email                      String          @unique
  phone                      String?          @unique
  name                       String
  password_hash              String?
  role                       UserRole         @default(CUSTOMER)
  email_verified             Boolean          @default(false)
  verification_token         String?          @unique
  verification_token_expires DateTime?
  reset_token                String?          @unique
  reset_token_expires        DateTime?
  kyc_verified               Boolean          @default(false)
  kyc_documents              String[]         @default([])
  otp_secret                 String?
  otp_expires                DateTime?
  saved_plots                String[]         @default([])
  created_at                 DateTime         @default(now())
  updated_at                 DateTime
  last_login                 DateTime?
  image                      String?
  emailVerified              DateTime?
  accounts                   accounts[]
  inquiries                  inquiries[]
  refresh_tokens             refresh_tokens[]
  sessions                   sessions[]
  site_visits                site_visits[]

  @@index([email])
  @@index([phone])
}

model testimonials{
  id         String   @id @default(cuid())
  name       String
  content    String   @db.Text
  role       String?
  rating     Int?
  company    String?
  avatar_url String?
  image      String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model site_settings {
  id                    String   @id
  site_name             String?
  tagline               String?  @db.Text
  company_email         String?  @unique
  company_phone         String?
  company_address       String?
  whatsapp_number       String?
  facebook_url          String?
  twitter_url           String?
  instagram_url         String?
  linkedin_url          String?
  youtube_url           String?
  about_us              String?  @db.Text
  logo_url              String?
  favicon_url           String?
  google_analytics_id   String?
  google_maps_api_key   String?
  business_hours        String?
  footer_text           String?
  meta_title            String?
  meta_description      String?
  meta_keywords         String?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}

model newsletter_subscriptions {
  id            String   @id @default(cuid())
  email         String   @unique
  is_active     Boolean  @default(true)
  subscribed_at DateTime @default(now())
  unsubscribed_at DateTime?
  source        String?  // e.g., "footer", "popup", "checkout"

  @@index([email])
  @@index([is_active])
}

model gallery_items {
  id          String      @id @default(cuid())
  title       String
  description String?     @db.Text
  type        GalleryType
  media_url   String
  thumbnail   String?
  location    String?
  plot_id     String?
  is_active   Boolean     @default(true)
  display_order Int       @default(0)
  created_at  DateTime    @default(now())
  updated_at  DateTime    @updatedAt

  @@index([type])
  @@index([is_active])
  @@index([display_order])
}

model verification_tokens {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

enum InquiryStatus {
  NEW
  CONTACTED
  QUALIFIED
  CONVERTED
  CLOSED
}

enum PlotStatus {
  AVAILABLE
  BOOKED
  SOLD
}

enum SiteVisitStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
  RESCHEDULED
}

enum UserRole {
  ADMIN
  CUSTOMER
}

enum GalleryType {
  IMAGE
  TOUR
}
